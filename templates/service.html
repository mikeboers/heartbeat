{% extends "_main.html" %}
{% block body %}

<h2>
    <a href="/">Services</a> &raquo; {{ service.name }}
</h2>

<p>
    <strong>CRON Specification:</strong>
    <code><span data-pk="{{ service.id }}" data-name="cron_spec" data-title='E.g. "*/5 * * * *" for every 5 minutes'>
        {{ service.cron_spec or '' }}
    </span></code>
    {% if service.cron_spec %}
        <br/>
        {% set cron_iter = service.cron_iter() %}
        <small>Next heartbeats: {% for i in range(5) %}{% if i %},{% endif%}
            {{ cron_iter.get_next() | utcfromtimestamp | timedeltaformat }}{% endfor %}</small>
    {% endif %}

<p>
    <strong>URL to Monitor:</strong>
    <span data-pk="{{ service.id }}" data-name="url_to_monitor">
        {{ service.url_to_monitor or '' }}
    </span>


<h3>Heartbeats</h3>
<table class="table table-striped table-hover">
    <thead><tr>
        <td><!-- status -->
        <td>Name
        <td>Time
        <td>Origin
        <td>Actions
    <tbody>
    {% for heartbeat in service.heartbeats | sort(attribute="time", reverse=True) %}
        {% include "_heartbeat_tr.html" %}
    {% endfor %}

    {% if not service.heartbeats %}
    <tr>
        <td>&nbsp;
        <td colspan="4"><em>No heartbeats.</em>
    {% endif %}

</table>


<h3>Script Integration</h3>
<p>Copy the following command into the end of your script to create
   a heartbeat here.
</p>
<input id="curl" class="input-block-level" type="text" value='curl -F"name={{ service.name }}" {{ request.url_root }}api/beat' />


{% endblock %}
{% block scripts %}
    {{ super() }}
    <script>

        // Select input contents when you click in it.
        $("#curl").click(function() {
           $(this).select();
        });

        $('[data-pk]').editable({
            placement: 'right',
            url: {{ url_for('edit_service_api') |tojson|safe }},
            success: function(response, value) {
                console.log('response: ', response);
            }
        });

    </script>
{% endblock %}
